---
layout: post
title: "汇编第3章笔记汇编语言基础"
subtitle: There's lots to learn!
gh-repo: IWITRIE/IWITRIE.github.io
gh-badge: [star, fork, follow]
tags: [汇编与逆向工程, 汇编语言, 笔记]
comments: true
mathjax: true
author: IWITRIE
---
### 重点
- 汇编语言的基本元素
	- 重点
		- 标识符、指令、伪指令
	- 难点
		- 伪指令
- 数据定义
	- 重点
		- BYTE、WORD、DWORD、DUP 
- 符号常量
	- 难点
		- $符号常量

### 汇编语言的基本元素
#### 常量
- 整数常量
	- \[ {+|-} ]数字[ 基数 ] 
	- 基数后缀（Radix）
		- d (decimal)、o(octonary)、h(hexadecimal)、b(binary)
		-  如果整数常量后面没有基数后缀，默认是十进制整数 10、10d、10o、10h、0A0h，10b 
		- ==以字母开头的十六进制常量前面必须加0==
- 整数表达式
	- 包含整数值和算数运算符的数学表达式
		- 表达式的结果不能超过32bits的表示范围
		- MOD：取余数运算
	- 算术运算符的优先级
		- （）优先级1
		-  \*、/、MOD，乘、除、取余，优先级2
		- +、-，加减，优先级3
- 实数常量
	- 十进制实数常量
		- 十进制实数常量由符号sign、整数、小数点、小数和指数组成
		-  \[sign]integer.\[integer]\[exponent]
		- 至少要有一个数字和一个小数点
	- 编码常数
		- 编码实数是以十六进制数表示一个实数，遵循IEEE浮点数格
- 字符常量
	- 单引号或者双引号括起来的单个字符
	-  汇编器会将其转化为ASCII编码
	- ‘A’、“B”
- 字符串常量
	- 以单引号或者双引号括起来的一串字符
	- ‘ABC’、“abc”
	- 嵌套引号
		- “print ‘Hello World’ on the terminal window” 
		- ‘print “Hello World” on the terminal window

#### 剩余部分
- 保留字
	- 指令助记符
		- MOV、ADD 
	- 伪指令
		- INCLUDE、PROC
	- 属性
		- BYTE、WORD
	- 预定义符号
		- $ \?

- 标识符
	- 标识符是程序员选择用来标识变量、常量、过程、代码的标号
	- 大小写不敏感
	- 第一个字符必须是字母、下划线、@、？或$
	- 第一个字符不能是数字（对比十六进制整数）
	- 标识符的名字不能与汇编器的保留字相同
- 指令
	- 指令是一条汇编与语句
		- 汇编器将汇编指令翻译为对应的机器指令
			- 标号
			- 指令助记符
			- 操作数
			- 注释
- 标号
	- 标号是充当指令或数据位置标记的标识符
	- 数据标号
		- 标识数据的地址
		- count DWORD 100
		- 相对于.data数据段在内存起始位置的偏移
		- OFFSET
			- 获取数据标号的内存偏移地址
			- mov eax, OFFSET str_hello
	- 代码标号
		- 标识代码的地址
		- 标识代码的地址，必须以冒号（:）结尾 
		- 通常作为跳转、循环指令的目标地址
		- target： mov eax，100h … jmp target
- 指令助记符
	- 指令助记符（instruction mnemonic）是一个简短的单词，用于表 示一条指令
	- mov、add、sub、mul、jmp、call
- 操作数
	- 是指令的操作对象
		- 寄存器 
		- 内存
		- 常量
		- I/O端口
- 注释
	- 单行注释`;`
	- 块注释
		- COMMENT伪指令和用户定义的符号
		- `COMMENT ! .... !`
- NOP 指令
	- 空指令
		- 用于计时循环
	- 占用一个字节的内存
		- 用于后续指令的对齐
		- IA-32从偶数双子地址出加载代码和数据时更加快速
- 伪指令
	- 伪指令内嵌在汇编语言源代码中，由汇编器识别、执行相应动作的命令 
	- 用于定义变量、段、过程、汇编器选项等
	- 定义变量
		- `my_var DWORD 100h；DWORD伪指令`
		- `mov eax, my_var ; mov指令`
	- 定义段（Segment）.
		- `.data、.code、.stack`
	- 定义过程（Procedure）
		- `PROC、ENDP`
	- 允许或禁止汇编器的某些特性
		- `OPTION、.386、.MODEL`
	- **伪指令不是程序在运行时执行的**
### 定义数据
- 内部数据类型
	- MASM内部以数据位的个数定义了多种数据类型
		- BYTE，db，8位
		- WORD，dw， 16位
		- DWORD，dd， 32位
		- QWORD ，dq，64位
	- MASM汇编器默认情况下，大小写不敏感
- 数据定义语句
	- 为变量在内存中保留存储空间
	- 为变量指定一个名字（==**数据标号**==）
	- ==\[变量名] 数据定义伪指令 初始值==
- 数据定义伪指令
	- BYTE，db，8 bits
	- WORD，dw， 16 bits
	- DWORD，dd， 32 bits
	- QWORD ，dq，64 bits
- 初始值
	- 多个初始值用逗号隔开
		- my_var DWORD 0, 1, 2, 3
	- 0: 可以指定初始值为0
	- ?: 表示在程序运行的时候初始化该变量
- 数据声明的位置
	- .data段声明初始化的变量
	- .data?段声明未初始化的变量
- 定义字符串
	- `str_hello BYTE “Hello World!”, 0Dh, 0Ah, BYTE “I love assembly language”, BYTE 0Dh, 0Ah, 0`
	- 0Dh和0Ah是CR/LF（回车、换行）的ASCII编码
	- 字符串的结尾是0
- DUP伪指令
	- 为字符串或者数组分配内存空间
	- BYTE 20 DUP（0）；20个字节的内存空间
	- BYTE 4 DUP（“Hello”）：20个字节，连续的4个“Hello”， 每个“Hello”5字节
- 定义WORD和SWORD数据
	- 在数据定义语句中如果使用WORD（用于定义字）和SWORD （用于定义有符号字）伪指令就可以为一个或多个16位整数分配 存储空间
	- word1 WORD 65535 ； 最大无符号字
	- 字数组：可以通过显示指令初始化每个元素，或使用DUP操作符 创建字数组
- 定义DWORD和SDWORD数据
	- 在数据定义语句中使用DWORD（定义双字）和SDWORD（定义 有符号双字）伪指令，可以为一个或多个32位的整数分配存储空 间
	- 双字数组：所谓双字数组，就是指可以通过显式地初始化数组每 个元素，或使用DUP操作符来创建双字数组
- 定义QWORD数据和TBYTE数据
	- 使用QWORD（定义8字节）伪指令可以定义64位的数据
	- 使用TBYTE（定义10字节）伪指令可以定义80位的数据
- 定义实数
	- REAL4定义4字节的单精度实数，REAL8定义8字节的双精度实数， REAL10定义10字节的扩展精读实数
	- 对于每个伪指令，都要求一个或多个与其数据尺寸相匹配的实数 常量初始值

### 符号常量
- 符号常量
	- 符号常量（或符号定义），将标识符与整数表达式或文本联系起来
	- 符号常量不占用存储空间
	- 变量占用存储空间
- =等号伪指令
	- 等号伪指令，将符号名和整数表达式联系起来
	- `COUNT = 500`
- 计算数组和字符串的大小
	-  MASM用$运算符存储当前语句的地址偏移值
	- $可以用来计算数组或字符串的大小
	- str_size = ($ - str_hello)
	- `dw_array DWORD 0, 1, 2, 3, 4`
	- `array_size = ($ - dw_array)/4`
- EQU伪指令
	- EQU伪指令将符号名与整数表达式或任意文本联系起来
		- name EQU expression
		- name EQU symbol
		- name EQU \<text>
	- example:
		- PI EQU 3.1415926
		- press_key EQU <“Press any key to continue…”, 0>
		- prompt BYTE pressKey
	- EQU伪指令不能在程序中重定义
	- “=”伪指令可以在程序中重定义
- TEXTEQU伪指令
	- TEXTEQU伪指令与EQU非常相似，同样可以用来创建文本宏（text macro）
	- 它有三种不同的使用格式：第一种格式会将文本赋值给符号；第二种格式则 将已定义的文本宏内容赋值给符号；第三种格式将整数表达式常量赋值给符 号。
	- name TEXTEQU \<text>
	- name TEXTEQU textmacro
	- name TEXTEQU %constExpr
